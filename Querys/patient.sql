create table dh_patient_list as ( 
 
-- PATIENTS
 
SELECT distinct cohort_id--, -- primary key for each cohort element
   --p.person_id, p.gender_concept_id, (extract(year from v.visit_start_date) - p.year_of_birth + 1) AS age_at_hospitalization,-- personal infos
   --m.measurement_concept_id, m.measurement_date, -- measurement infos
   --c.condition_concept_id, c.condition_start_date, c.ext_cond_source_value_kcd, -- condition infos
   --v.visit_start_date, v.visit_end_date, --visit infos   
   --d.drug_concept_id, d.drug_exposure_start_date, d.drug_exposure_end_date, -- drug infos
   --(v.visit_end_date - v.visit_start_date + 1) AS hospitalization_period --, (m.measurement_date - v.visit_start_date) as observation_period -- periods infos (unit: days)
FROM (SELECT cohort_id, person_id, visit_start_date, visit_end_date FROM public.dh_raw_cohort_all ) AS v -- raw_cohorts visit_occurrence table
 
LEFT JOIN 
(
	SELECT person_id, measurement_concept_id, measurement_date, value_source_value
	FROM cdm.measurement 
	WHERE measurement_concept_id = 3044936 and value_source_value like '%ositive%') AS m   -- join measurement table
ON v.person_id = m.person_id
 
LEFT JOIN cdm.person AS p   -- join person table
ON p.person_id = v.person_id
 
LEFT JOIN 
(
	SELECT person_id, condition_start_date, ext_cond_source_value_kcd
	FROM cdm.condition_occurrence
	WHERE ext_cond_source_value_kcd = 'A047') AS c -- join condition_occurrence table
ON c.person_id = v.person_id
 
LEFT JOIN (
SELECT drug_concept_id, drug_exposure_start_date, drug_exposure_end_date, person_id
FROM cdm.drug_exposure 
WHERE drug_concept_id in (42479137, 42481485, 40743433, 43149939, 44033418, 44033289, 44033346, 44032321, 44032716, 21045207, 21056893, 21091402, 21072045, 21081705, 21075545, 21076659, 21160122, 21113968, 587749, 43171617, 43204640, 43215472, 43282700, 43265620, 43268388, 43622687, 43585631, 43692360, 43696020, 43696043, 43763957, 43766809, 43767156, 43747748, 43744633, 43823310, 43801234, 43803334, 43855117, 36892634, 36891786, 36885745, 36886698, 36888636, 36884740, 36882918, 36882928, 36882928, 36888740, 36881104, 36882015, 36882976, 36882977, 36882987, 36888821, 36880212, 36884892, 44071000, 44071236, 44058342, 44046423, 44123048, 44123418, 44109895, 44110250, 44097155, 44098080, 44084614, 40838338, 40838338, 40837149, 40837160, 40836491, 40836500, 40834178, 40822383, 40823933, 40900502, 40900502, 40868311, 40865896, 40928230, 40930863, 40931576, 40931576, 40931583, 40927921, 40931098, 40960086, 40959350, 40962888, 40993055, 40992367, 41052157, 41053123, 41056407, 41052822, 41025199, 41025208, 41021570, 41021574, 41023282, 41084079, 41087928, 41084360, 41086117, 41146861, 41146556, 41150679, 41150679, 41150681, 41150681, 41150697, 41150697, 41116436, 41115628, 41117334, 41118904, 41181742, 41178138, 41181459, 41209621, 41209624, 41211345, 41209773, 41211616, 41212015, 41209603, 41240723, 41242457, 41241006, 41241006, 41242048, 41240432, 41213133, 41274985, 41275009, 41304221, 41306069, 41303379, 41272930, 41271419, 41271426, 42711191, 42712607, 42712607, 42723271, 42723273, 42724682, 42722088, 42729859, 42731293, 42729905, 42722253, 42722253, 42720925, 42720925, 42725888, 42727245, 42727245, 44187572, 44172775, 44168757, 44165084, 44165194, 36406716, 21076658, 40990598, 41052803, 41209612, 41302536, 36270023, 36272463, 36259735, 36264938, 19134709, 36257290, 36408942, 35130577, 35135565, 35136257, 35145602, 35150370, 42948761, 42951831, 42954868, 42973607, 42973607, 1742284, 1713472, 1734134, 19073181, 19105299, 1713641, 19060461, 19062826, 19062826, 1713417, 1790699, 1790729, 40171743, 42707542, 1717438, 19105298, 19127606, 19127602, 1728735, 19127600, 19127625, 1728650, 1728572, 1728550, 42902556, 19127608, 19126426, 1728609, 1728886, 1728942, 1713734, 1747426, 40168110, 19129655, 19075378, 997892, 19105319, 19107479, 19105303, 19106638, 19018976, 19079151, 19079217, 1747078, 19054962, 19105596, 19107698, 19104507, 19106088, 19062067, 19057998, 1759848, 19019858, 1728449, 1760056, 19123643, 19121228, 19059531, 1724671, 19127604, 19076995, 1747076, 1750727, 19104461, 19127592, 1759851, 19115169, 19104318, 19021637, 19104645, 19060911, 19128975, 1747298, 19105312, 1729744, 19105348, 19106635, 1707823, 19061736, 19106619, 1730002, 19133873, 1717540, 45892603, 46287391, 46275616, 46275616, 35605340, 40220676, 587240, 587931, 588691, 590266, 36420316, 36420641, 36785538, 36786411, 36788176, 36810944, 36811481, 43138585, 43138625, 40732957, 40744024, 43147095, 43152212, 21101114, 21101360, 21071967, 21081698, 21081698, 21150392, 43193598, 43216993, 43264107, 43262519, 43282452, 43273512, 43587398, 43582608, 43582610, 43586083, 43638870, 43659036, 43709975, 43727406, 43727687, 43731386, 43748794, 43857446, 36894561, 36894568, 36894623, 36894624, 36894651, 36894651, 36889664, 36889764, 36889773, 36892640, 36892666, 36890802, 36890806, 36893692, 36893770, 36886770, 36880942, 36886853, 36880068, 36881039, 36881997, 36881997, 36882980, 36883966, 44071741, 44059439, 44058343, 44045975, 44046425, 44045729, 44123021, 44110897, 44110409, 44109868, 44096996, 44097303, 44097373, 44097548, 44097555, 44084463, 44084464, 44085126, 44084071, 40836488, 40838029, 40865241, 40899934, 40898677, 40867569, 40959070, 40994143, 40990767, 41053256, 41056384, 41056384, 41056393, 41056409, 41056419, 41054532, 41054533, 41052990, 41053004, 41025206, 41023280, 41023284, 41024884, 41021984, 41087937, 41147130, 41146561, 41150709, 41115311, 41117341, 41118109, 41181721, 41181721, 41178135, 41209818, 41210329, 41209604, 41243723, 41240586, 41241007, 41241007, 41244108, 41242960, 41213115, 41304216, 41304220, 41302661, 41306086, 41270800, 41270801, 41271819, 41272931, 41271420, 41273145, 42719265, 42715110, 42713883, 42711192, 42711252, 42711252, 42720618, 42720676, 42723557, 42728616, 44179847, 44172776, 44164860, 44161288, 44168892, 36406659, 36404376, 44045908, 44123340, 40896775, 41055124, 41240572, 36272464, 36272513, 36274874, 36257292, 36264940, 36257288, 36267505, 35140795, 35142416, 35151314, 35158967, 35160140, 42948459, 42951317, 42954876, 1717433, 1742254, 19105326, 19105326, 1734108, 1717436, 19106272, 19073216, 922667, 1713520, 19088224, 19073185, 1713416, 19106222, 19060406, 19105301, 19061490, 19063162, 19073779, 1713419, 19103587, 19006425, 19006425, 19105300, 19133923, 19129058, 19106167, 19106168, 19106168, 19103730, 19104338, 42708912, 1728732, 19127610, 1728882, 1728740, 42902779, 19077575, 19101783, 1747328, 1713961, 19104337, 19103855, 19002458, 1747077, 19057999, 19104319, 19006318, 1728420, 19107619, 19027712, 19060153, 19115155, 1729750, 1729751, 19106675, 1729873, 1728548, 1702936, 1747352, 19063876, 19080706, 19129036, 19128708, 19128708, 19129099, 19129099, 997974, 19115147, 1717539, 19106687, 19059664, 19076959, 19018877, 19075377, 1760054, 1713694, 19123605, 19115097, 19006383, 19075531, 19061197, 19076953, 19076957, 19107971, 19060405, 19106776, 19105801, 19079750, 19079749, 19106642, 19041154, 19041155, 1734206, 46287452, 35604113, 35606372, 35605341, 35603400, 42629036, 587066, 589510, 40733895, 40740988, 36420644, 36789927, 36789927, 36813852, 43134971, 43139531, 40732930, 43144417, 43160777, 21032172, 21091410, 21093954, 21061866, 21150459, 21145244, 21160118, 21135363, 21132494, 43193160, 43182622, 43168360, 43173166, 43218154, 43211054, 43258432, 43588593, 43587912, 43675071, 43675072, 43637531, 43640296, 43638729, 43658087, 43658412, 43715292, 43768057, 43787214, 43856397, 43856397, 43854375, 36894711, 36890693, 36891659, 36892633, 36890803, 36890868, 36890907, 36885852, 36881902, 36885898, 36887763, 36880069, 36881038, 36882896, 36882917, 36884817, 36883885, 36879320, 36883967, 36881229, 44071739, 44071744, 44059440, 44059442, 44059444, 44058939, 44058313, 44058752, 44045385, 44123022, 44123115, 40834602, 40834602, 40898938, 40896776, 40898671, 40898682, 40869409, 40869237, 40930515, 40930560, 40928473, 40928473, 40931585, 40931591, 40928787, 40929770, 40961105, 40962623, 40994130, 40994130, 41056390, 41052663, 41052664, 41052820, 41054543, 41025161, 41025161, 41023276, 41024053, 41025603, 41021982, 41084816, 41087904, 41087904, 41087350, 41086774, 41086112, 41086128, 41084522, 41086315, 41147025, 41147025, 41147968, 41119163, 41119182, 41115619, 41117352, 41114965, 41181716, 41181716, 41181755, 41177462, 41211349, 41244086, 41244096, 41244096, 41241277, 41242959, 41213588, 41213114, 41275001, 41304214, 41305814, 41302959, 41305618, 41304938, 41271821, 41272928, 41272928, 42710104, 42712494, 42712585, 42721964, 42720709, 42720709, 42722107, 42728725, 44187719, 44176131, 44176131, 44176146, 44176348, 44180228, 36408166, 36408962, 36405920, 36403597, 44110420, 35407421, 36259782, 36267519, 1713738, 35134610, 35134658, 35135558, 35152381, 35160369, 42948506, 42956968, 19105336, 19107852, 19073219, 1717475, 19063885, 42800399, 19061430, 1717407, 922668, 19063106, 19063106, 1713370, 918363, 19058103, 19065113, 1790697, 19129037, 19133905, 19055001, 40174649, 40161023, 42707537, 42902943, 19127611, 998014, 19127998, 40161189, 19106634, 1789277, 19008692, 19107907, 1747073, 19076960, 1728474, 19105807, 1747205, 19107880, 19001150, 1729746, 997973, 19106636, 19121371, 19114763, 19063877, 1712572, 19122216, 19106677, 1746121, 19122220, 997961, 19017195, 19067402, 19096594, 1713983, 1747108, 19011634, 19063438, 19006381, 19050774, 19050773, 19076991, 19006382, 19104321, 19106410, 1743223, 19011482, 45776739, 46287509, 35606367, 35606370, 36783615, 42479124, 36811756, 36814644, 43135481, 44032926, 43155797, 43159234, 21024435, 21024435, 21093957, 21093958, 21062118, 21084503, 21081710, 21160133, 21120877, 21130412, 997898, 1355759, 1355762, 43195156, 43182639, 43217991, 43212316, 43255751, 43288298, 43623192, 43620729, 43589290, 43693922, 43767157, 43744631, 36894545, 36890735, 36893613, 36891785, 36892703, 36892783, 36893769, 36881924, 36882828, 36882830, 36884739, 36882920, 36883801, 36883906, 36884927, 44072311, 44071237, 44059441, 44059485, 44045730, 44123047, 44123049, 44123050, 44123419, 44124120, 44124126, 44110413, 44110421, 44109892, 44097567, 44084135, 40838329, 40838329, 40838339, 40838343, 40834725, 40834726, 40823314, 40824846, 40899740, 40899740, 40900501, 40900501, 40900513, 40900533, 40898487, 40869394, 40931417, 40928043, 40928050, 40961808, 40962625, 40958683, 40994133, 40994133, 40994136, 40994136, 40990311, 40990590, 40990595, 40992368, 41056408, 41052662, 41055863, 41053563, 41055254, 41054527, 41055293, 41023071, 41024017, 41023592, 41086127, 41148611, 41148611, 41147029, 41150703, 41116069, 41117138, 41118083, 41180657, 41209007, 41242254, 41244104, 41240452, 41240452, 41213123, 41304218, 41306096, 41273827, 41271409, 41271411, 41271422, 41271424, 41273872, 41273153, 41271612, 42713824, 42713840, 42715189, 42715189, 42716596, 42715265, 42712527, 42711263, 42731501, 42720605, 42731203, 42729920, 42724517, 42724517, 42728714, 43517205, 44179911, 44176342, 44176484, 36884847, 36884847, 40897052, 40959357, 41052808, 41021549, 41178118, 41302532, 36269970, 36272462, 35130775, 35132419, 35135783, 35151209, 35157127, 42932489, 42966045, 42966045, 42973604, 42973604, 19080152, 19073188, 1713338, 1717503, 1717408, 1717408, 19107861, 922669, 19073183, 19073776, 1713412, 19105294, 19105350, 1747106, 1717435, 1717434, 1717434, 19073214, 19055002, 40236526, 42902744, 19063105, 19063105, 19105338, 19006428, 19073189, 19105035, 1728920, 1747396, 19129059, 19102510, 19063694, 19019417, 19001222, 19105313, 19047073, 19105309, 19105305, 19105321, 19104822, 19104820, 19070254, 19131485, 19128233, 19060616, 19061625, 1728446, 19105334, 1713699, 1747354, 1747204, 997893, 19124327, 19058072, 1750568, 1750569, 19123585, 19101844, 1747050, 1800837, 19115065, 19075380, 1797536, 1713960, 19030822, 19061735, 19074700, 19104322, 19104454, 19050771, 19021108, 19076993, 19076992, 1728442, 19106641, 19106097, 19106639, 19022975, 19061487, 1724733, 19106620, 19133863, 19128200, 45775467, 45892712, 46275427, 46275427, 35603088, 587638, 588475, 588475, 40749418, 36420046, 36782765, 36786507, 42479125, 42479165, 42481512, 42483390, 42483390, 43138597, 40732934, 40733348, 40741060, 43145127, 44032914, 44032763, 21042264, 21025333, 21093032, 21101297, 21115805, 21150454, 21123288, 21130575, 43177580, 43196183, 43173611, 43204988, 43207092, 43216438, 43293351, 43583415, 43583415, 43643537, 43642174, 43658408, 43715289, 43725578, 43711822, 43765195, 43730252, 43749923, 43782622, 36894650, 36894650, 36890664, 36891660, 36892664, 36891737, 36891737, 36889916, 36879995, 36880946, 36880961, 36887817, 36880146, 36881989, 36884895, 36883995, 44071740, 44046422, 44123591, 44110808, 44097028, 44097983, 44085183, 44084102, 35412099, 40838330, 40838330, 40838358, 40836663, 40897447, 40897447, 40898684, 40865867, 40865899, 40928212, 40931593, 40931599, 40931605, 40929783, 40959363, 40962513, 40962710, 40959812, 40994161, 41056412, 41052823, 41025679, 41025125, 41021443, 41021565, 41021760, 41024883, 41020955, 41084080, 41086114, 41086123, 41148840, 41148841, 41149587, 41149865, 41149865, 41150680, 41150680, 41150696, 41115944, 41119176, 41116338, 41118086, 41118899, 41178132, 41178133, 41209626, 41211360, 41210018, 41242249, 41240282, 41242949, 41274983, 41274983, 41302547, 41306055, 41306055, 41302424, 41304940, 41273869, 41273152, 41271599, 42716868, 42716868, 42715111, 42718047, 42716597, 42711253, 42711253, 42721899, 42720546, 42722071, 42731267, 42724595, 44187375, 36408170, 36403577, 36403577, 36894544, 40865874, 41052801, 41084355, 41147129, 41147144, 41115604, 41240575, 41302529, 36272564, 36275155, 36267453, 35138534, 35138708, 35144492, 35152213, 35152242, 35158540, 42951266, 42951266, 42954872, 19073182, 1713640, 19073184, 19079893, 1713444, 1713444, 19064637, 1713473, 19105339, 1747105, 19079928, 19062538, 19062538, 19063161, 19107870, 1713336, 1717410, 997958, 1790698, 40178233, 40178233, 19133859, 43560741, 19127596, 40236523, 1836243, 1836243, 40169060, 1713418, 19006461, 19103729, 1713475, 19079894, 1717474, 19127634, 19127594, 1797594, 19125429, 1797580, 19125424, 40161180, 40164101, 1797515, 19104397, 19105304, 19076954, 19006427, 19060154, 1747107, 19107466, 1728475, 19021109, 19105354, 1713957, 19006688, 19106232, 19070253, 19007702, 19063878, 19063875, 1728472, 1742334, 997976, 19107099, 19105597, 1746118, 19115197, 1747296, 19075427, 1724693, 19080738, 19075421, 19123639, 19123645, 19019481, 1724735, 19075534, 1800836, 1747294, 19107908, 19075425, 997899, 1747109, 19060707, 19126615, 19074699, 19105314, 19076958, 1729743, 1743224, 1707824, 19076624, 19095074, 19079748, 19060618, 19115148, 19124564, 46275433, 46275433, 46275444, 46275444, 46275622, 46275622, 35606368, 35605336, 35603389, 35603087, 35604119, 586968, 588276, 589170, 589942, 40743412, 36420638, 36786087, 19073217, 19075422, 36811547, 43134186, 43133705, 44033419, 21042457, 21024671, 21101362, 21140339, 21140614, 21120876, 21120591, 21133421, 21169889, 21170118, 21170181, 1355740, 1355750, 43196065, 43196067, 43183574, 43179696, 43185058, 43282699, 43271781, 43673752, 43673752, 43661637, 43692681, 43729807, 43747273, 43745895, 43819851, 43838383, 43837944, 36894709, 36889742, 36889743, 36889763, 36891650, 36889809, 36890805, 36890847, 36891810, 36892827, 36886716, 36888637, 36880086, 36886914, 36880145, 36884816, 36888822, 36884894, 36884023, 36885007, 36885007, 44072171, 44071738, 44072258, 44072308, 44071204, 44071204, 44059445, 44058751, 44046250, 44110896, 44110030, 40837521, 40837521, 40834912, 40865271, 40822365, 40900499, 40900499, 40897059, 40865888, 40867571, 40867578, 40869153, 40930554, 783197, 40929776, 40962365, 40961113, 40959071, 40990438, 40993059, 41052475, 41052827, 41052831, 41025168, 41025194, 41021566, 41021569, 41023279, 41084815, 41086126, 41150403, 41150695, 41119159, 41118066, 41118081, 41117354, 41118113, 41118892, 41181213, 41177464, 41178316, 41211353, 41209605, 41240580, 41240582, 41244093, 41306102, 41273410, 41273466, 41273833, 41271413, 41271414, 41273867, 41273143, 42718248, 42718248, 42715179, 42713825, 42712586, 42720554, 42728905, 42728905, 42723556, 42725893, 44183964, 44176206, 44180233, 44168893, 36408959, 36408187, 40990580, 41115600, 41180474, 36267517, 42731137, 44183647, 44187370, 36272567, 36262245, 35133390, 35137867, 35138838, 35139028, 35143958, 35156891, 35157296, 35157573, 35160855, 42954880, 42973601, 42973601, 1742255, 19102540, 19073218, 19103484, 1717432, 1836242, 1836242, 19105355, 1713521, 1713420, 19063163, 19061823, 19061823, 19107185, 42707533, 40182302, 40168575, 42707540, 19061916, 19073186, 1713414, 19063582, 19060462, 19127598, 1728917, 19125430, 42902523, 1797516, 19105446, 1729745, 19082703, 923115, 19019416, 19107621, 19104339, 19105889, 19105327, 1728421, 19009139, 19009140, 19105349, 19112836, 19001146, 19011873, 19019415, 19107699, 19107697, 19105322, 19128709, 19128709, 19115140, 19122215, 1746119, 19128707, 19115171, 19076407, 19122174, 19105468, 19103315, 1724668, 1750562, 19123591, 19123642, 1713698, 1733766, 19060619, 19075391, 1713982, 19107919, 1724667, 19105351, 1759847, 19006465, 19050772, 1747104, 19096077, 1724711, 19106640, 19107464, 19064998, 1716905, 19115096, 46287441, 35605256, 587072, 588052, 588052, 36420557, 36420635, 42482101, 42482102, 42482115, 36811101, 36813336, 43139535, 44032346, 43160707, 43160751, 21042525, 21025581, 21025576, 21091188, 21081711, 21160100, 21160134, 21113969, 1355756, 43193634, 43196189, 43179705, 43179410, 43218288, 43618669, 43600651, 43679512, 43695550, 43691563, 43691563, 43694287, 43749825, 43823326, 43817376, 43819850, 43781390, 43840071, 43839473, 43854382, 36894542, 36889626, 36892781, 36885719, 36885743, 36888667, 36881893, 36887744, 36880085, 36880092, 36882919, 36888742, 36883812, 36883017, 36883037, 36883887, 44072256, 44071238, 44071241, 44058914, 44059438, 44058344, 44045672, 44110807, 44097549, 44084615, 35407465, 35412160, 35412161, 40838367, 40837152, 40836496, 40836497, 40823277, 40900514, 40899351, 40869414, 40865885, 40867568, 40929586, 40959367, 40959507, 40963266, 40962869, 40962869, 40994137, 41052628, 41052658, 41052658, 41052659, 41053595, 41055252, 41052819, 41054535, 41055296, 41025166, 41025166, 41020660, 41023291, 41021714, 41023524, 41087902, 41087911, 41084364, 41086115, 41083738, 41147007, 41149550, 41147148, 41150682, 41150682, 41150710, 41115486, 41115620, 41117343, 41117351, 41180609, 41179907, 41179912, 41179914, 41180853, 41209478, 41209478, 41242049, 41213505, 41302956, 41302956, 41274783, 41272933, 41273146, 42715109, 42718048, 42713899, 42727224, 42725887, 42727355, 35758221, 44187603, 44176345, 44180088, 44180126, 44165036, 44169037, 36407488, 36403559, 43604825, 43604825, 41084354, 41147124, 41271401, 36270021, 36257265, 36404278, 35129120, 35129419, 35131865, 35138828, 35141989, 35147167, 35149793, 35151489, 35160129, 42948106, 42951269, 42951269, 19107853, 1713337, 19006429, 1717411, 19006426, 19006426, 1713442, 1713474, 19105353, 1713445, 1713445, 19073187, 1713415, 19006420, 19006420, 1717437, 19061822, 19061822, 19106618, 1728918, 40171750, 42707536, 42707538, 19106524, 19061770, 1728738, 1728890, 19127627, 19123873, 43560159, 1728916, 42902619, 44784897, 19125418, 40166455, 19102197, 1797535, 19107155, 19107154, 19060617, 1747074, 19105806, 19107620, 19104320, 19104511, 19104512, 19001149, 19060528, 19001148, 997975, 19105595, 19106676, 19021886, 1750730, 19105765, 1728451, 1728447, 19101672, 19080618, 1713697, 1747355, 19123644, 19075428, 19106686, 19022244, 19018878, 1728611, 1759877, 19123640, 19075606, 19075379, 19059624, 19006466, 1747324, 19054940, 19079112, 1747072, 19023670, 19106637, 19019420, 19079216, 46287383, 35604111, 35605343, 35603086, 590054, 40749422, 36789920, 36789920, 40733343, 40734095, 44032125, 43158093, 21042456, 21035071, 21032540, 21101373, 21101374, 21145245, 21163135, 21113958, 43185229, 43172047, 43174220, 43260193, 43284336, 43281961, 43266279, 43584720, 43601991, 43677545, 43635757, 43692807, 43747749, 43760767, 43821944, 43784198, 43834797, 43839359, 36894639, 36894710, 36894767, 36891634, 36892620, 36891711, 36891736, 36891736, 36893768, 36880000, 36887743, 36887774, 36887774, 36884763, 36883822, 36879271, 36882093, 36882117, 44072257, 44071239, 44071242, 44046421, 44045448, 44045731, 44123420, 44123590, 44124125, 44109867, 44109867, 44096995, 44097029, 44084068, 44084068, 44084069, 44084069, 44084070, 44084070, 44084100, 35409001, 40835162, 40835162, 40838341, 40838376, 40834678, 40834720, 40897240, 40897454, 40900517, 40900539, 40896903, 40866301, 40867367, 40865887, 40930521, 40931601, 40928039, 40928045, 40929787, 40961838, 40961306, 40991040, 40994163, 40993641, 40993764, 41056379, 41056379, 41052799, 41054534, 41025203, 41020928, 41087900, 41087900, 41084573, 41147891, 41148829, 41146558, 41150698, 41150698, 41119172, 41119183, 41117141, 41115615, 41178121, 41178131, 41180738, 41212830, 41209772, 41209008, 41210013, 41210013, 41209201, 41212498, 41240583, 41243810, 41243811, 41274998, 41304217, 41306067, 41306085, 41302263, 41304932, 41271820, 41271299, 41271299, 41271398, 41274661, 42711391, 42717873, 42719403, 42715180, 42713882, 42712590, 42712590, 42724643, 42720564, 42720564, 42720604, 42721980, 42727234, 42728608, 42728608, 42728715, 44187712, 44187712, 44187672, 44172437, 44180169, 44180191, 44180235, 44161289, 36407390, 36892619, 41052474, 41052812, 41115606, 41115609, 41271416, 36257195, 36257226, 35138450, 35142000, 35142877, 35151561, 35151688, 35152536, 42924564, 42944057, 42944062, 42948765, 42951326, 42951876, 42965655, 42973655, 42973658, 19107860, 19105295, 19006430, 1151426, 19107830, 19107830, 1734107, 19073777, 19028283, 1713413, 1713476, 19058200, 19058200, 19105335, 42800401, 1717481, 19006421, 19006421, 1236499, 1742291, 19128842, 19129063, 19124901, 40168239, 40168047, 40171747, 1146884, 19112562, 42903196, 19127623, 1728888, 1728884, 19127613, 19127539, 19127619, 1790731, 19127628, 1836521, 1713767, 1747459, 19105296, 19080003, 19054963, 19080705, 1713959, 19054961, 19105315, 19106411, 19106096, 19001220, 1713671, 19105306, 19107412, 1721547, 1728547, 1712573, 19128705, 19128706, 19128706, 19115156, 19006044, 19079771, 19079772, 19070252, 1746143, 1746143, 1746145, 1734168, 19063693, 19031265, 1750501, 19123587, 1713693, 1759879, 19076956, 19060620, 19113782, 19063691, 19075532, 19075376, 19112943, 19104453, 1747292, 19063408, 19076955, 19063692, 19019411, 19105293, 19104821, 19106643, 1729783, 19023669, 19102471, 1789300, 1747454, 1734209, 46287379, 35604115, 35605338, 35605342, 40220671, 40220673, 587813, 36417377)
)
AS d -- join drug_exposure table
ON d.person_id = p.person_id
 
WHERE ((d.drug_exposure_start_date >= v.visit_start_date) and (d.drug_exposure_start_date <=v.visit_end_date)
       or  (d.drug_exposure_end_date >= v.visit_start_date) and (d.drug_exposure_end_date <=v.visit_end_date)) -- exposed after hospitalization
   and (
           (
			   	m.measurement_concept_id = 3044936 and m.value_source_value like '%ositive%'   -- join measurement table
	   			and (d.drug_exposure_start_date < m.measurement_date and m.measurement_date <= v.visit_end_date)
           )
       or
           (
			   c.ext_cond_source_value_kcd = 'A047'
			   and (d.drug_exposure_start_date < c.condition_start_date and c.condition_start_date <= v.visit_end_date)
           )
   )
)